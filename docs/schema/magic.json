{
  "$schema":"http://json-schema.org/draft-04/schema#",
  "type":"object",
  "properties":{
    "version":{
      "type":"string"
    },
    "name":{
      "type":"string"
    },
    "root":{
      "type":"string"
    },
    "variables":{
      "type":"array",
      "items":{
        "$ref":"#/definitions/Variable"
      }
    },
    "casts":{
      "type":"object",
      "additionalProperties":{
        "$ref":"#/definitions/Cast"
      }
    }
  },
  "required":[
    "version",
    "name",
    "root",
    "casts"
  ],
  "definitions":{
    "BaseVariable":{
      "type":"object",
      "properties":{
        "name":{
          "type":"string"
        }
      },
      "required":[
        "name"
      ]
    },
    "LiteralVariable":{
      "type":"object",
      "allOf":[
        {
          "$ref":"#/definitions/BaseVariable"
        },
        {
          "properties":{
            "value":{
              
            }
          },
          "required":[
            "value"
          ]
        }
      ]
    },
    "TemplateVariable":{
      "type":"object",
      "allOf":[
        {
          "$ref":"#/definitions/BaseVariable"
        },
        {
          "properties":{
            "template":{
              "type":"string"
            }
          },
          "required":[
            "template"
          ]
        }
      ]
    },
    "EnvironmentVariable":{
      "type":"object",
      "allOf":[
        {
          "$ref":"#/definitions/BaseVariable"
        },
        {
          "properties":{
            "env":{
              "type":"string"
            }
          },
          "required":[
            "env"
          ]
        }
      ]
    },
    "Variable":{
      "oneOf":[
        {
          "$ref":"#/definitions/LiteralVariable"
        },
        {
          "$ref":"#/definitions/TemplateVariable"
        },
        {
          "$ref":"#/definitions/EnvironmentVariable"
        }
      ]
    },
    "FileSource":{
      "type":"object",
      "properties":{
        "file":{
          "type":"string"
        }
      },
      "required":[
        "file"
      ]
    },
    "DocumentSource":{
      "type":"object",
      "properties":{
        "document":{
          "type":"string"
        }
      },
      "required":[
        "document"
      ]
    },
    "MagicSource":{
      "type":"object",
      "properties":{
        "magic":{
          "type":"string"
        },
        "casts":{
          "type":"array",
          "items":{
            "type":"string"
          }
        }
      },
      "required":[
        "magic"
      ]
    },
    "Source":{
      "oneOf":[
        {
          "type":"string"
        },
        {
          "$ref":"#/definitions/FileSource"
        },
        {
          "$ref":"#/definitions/DocumentSource"
        },
        {
          "$ref":"#/definitions/MagicSource"
        }
      ]
    },
    "Cast":{
      "type":"object",
      "properties":{
        "to":{
          "type":"string"
        },
        "from":{
          "$ref":"#/definitions/Source"
        },
        "variables":{
          "type":"array",
          "items":{
            "$ref":"#/definitions/Variable"
          }
        },
        "if":{
          "$ref":"#/definitions/Condition"
        },
        "unless":{
          "$ref":"#/definitions/Condition"
        },
        "each":{
          "type":"string"
        },
        "as":{
          "type":"string"
        },
        "include":{
          "$ref":"#/definitions/Condition"
        },
        "only":{
          "$ref":"#/definitions/Condition"
        }
      },
      "required":[
        "to",
        "from"
      ],
      "dependencies":{
        "as":[
          "each"
        ],
        "include":[
          "each"
        ],
        "omit":[
          "each"
        ]
      },
      "allOf":[
        {
          "oneOf":[
            {
              "allOf":[
                {
                  "not":{
                    "required":[
                      "if"
                    ]
                  }
                },
                {
                  "not":{
                    "required":[
                      "unless"
                    ]
                  }
                }
              ]
            },
            {
              "required":[
                "if"
              ],
              "not":{
                "required":[
                  "unless"
                ]
              }
            },
            {
              "required":[
                "unless"
              ],
              "not":{
                "required":[
                  "if"
                ]
              }
            }
          ]
        },
        {
          "oneOf":[
            {
              "allOf":[
                {
                  "not":{
                    "required":[
                      "include"
                    ]
                  }
                },
                {
                  "not":{
                    "required":[
                      "omit"
                    ]
                  }
                }
              ]
            },
            {
              "required":[
                "include"
              ],
              "not":{
                "required":[
                  "omit"
                ]
              }
            },
            {
              "required":[
                "omit"
              ],
              "not":{
                "required":[
                  "include"
                ]
              }
            }
          ]
        }
      ]
    },
    "Condition":{
      "type":"string"
    }
  }
}